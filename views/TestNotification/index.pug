doctype html
html(lang="en")
    head
        include /common/head.pug
        script(src='https://cdn.onesignal.com/sdks/OneSignalSDK.js')
        script.
            //OneSignal setup
            var OneSignal = window.OneSignal || [];
            OneSignal.push(function() {
                OneSignal.init({
                    appId: "#{onesignalAppId}",
                });
            });
            
            function init(){
                //OnseSignal load sent notifications
                function getNotifications(){
                    fetch('/TestNotification/getNotifications/', {method: 'GET'})
                        .then(function(response) {
                            if(response.ok) {
                                return response.json();
                            }
                            else { throw new Error('Request failed.'); }
                        })
                        .then(function(responseData) {
                            let parsedData = responseData.data;
                            let divNotificationsList = document.getElementById('NotificationsList');
                            divNotificationsList.innerHTML = "";
                            parsedData.forEach(function(element){
                                let p = document.createElement("p");
                                let text = document.createTextNode(JSON.stringify(element));
                                p.appendChild(text);
                                divNotificationsList.insertBefore(p, null);
                            });
                        })
                        .catch(function(error) {
                            console.log(error);
                        });
                }
                setInterval(function() {
                    getNotifications();
                }, 1000);
                //OnseSignal send notification
                let sendBtn = document.getElementById('sendNotification');
                sendBtn.addEventListener('click', function(e) {
                    console.log('button was clicked');

                    fetch('/TestNotification/sendNotification/', {method: 'POST'})
                        .then(function(response) {
                            if(response.ok) {
                                console.log('Notification sent');
                                //getNotifications();
                            }
                            else { throw new Error('Request failed.'); }
                        })
                        .catch(function(error) {
                            console.log(error);
                        });
                });
            }
    body(onload="init()")
        div(class="slds-grid slds-gutters")
            div(class="slds-col")
                h1 Test Web Push Notifications
                p #{title}
                br
                p
                    button(type='button', id="sendNotification") Send Notification
                br
                p Notifications:
                #NotificationsList
                .slds-notification-container
                    div(class="slds-notification", role="dialog", aria-labelledby="noti77", aria-describedby="dialog-body-id-51")
                        div(class="slds-notification__body", id="dialog-body-id-51")
                            a(href="javascript:void(0);", class="slds-notification__target slds-media")
                                span(class="slds-icon_container slds-icon-standard-task slds-media__figure", title="task")
                                    svg(class="slds-icon slds-icon_small", aria-hidden="true")
                                        use(xlink:href="/assets/icons/standard-sprite/svg/symbols.svg#task")
                                div(class="slds-media__body")
                                    h2(class="slds-text-heading_small slds-m-bottom_xx-small", id="noti77")
                                        span(class="slds-assistive-text") task notification:Call Two: Jane Johnson
                                    p Task due on Jan 8
                            button(class="slds-button slds-button_icon slds-button_icon-container slds-notification__close", title="Dismiss Call Two: Jane Johnson notification")
                                svg(class="slds-button__icon", aria-hidden="true")
                                    use(xlink:href="/assets/icons/utility-sprite/svg/symbols.svg#close")
                                span(class="slds-assistive-text") Dismiss Call Two: Jane Johnson notification